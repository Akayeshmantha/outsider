---
title: "How to build an `outsider` module"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

`outsider` allows users to install and run programs on their own computer
without the need to leave the R environment. If there is a command-line program
that is not available through `outsider` you can create your own module to make 
it available. In this article, we will outline what makes an `outsider` module
and then provide a simple walkthrough of a module.


If you can install the program on your own machine and have
some experience with R packages and GitHub then you should be readily able
to create one.

In this article, we will walk you through how to create a module using a very
simple command line program that prints whatever the user provides it.

To follow this guide you will need the following:
* a GitHub account (sign-up [here](https://github.com/))
* a Docker-Hub account (sign-up [here](https://hub.docker.com/))

## Module structure

At its heart, an `outsider` module is just an R package with a `Dockerfile`.
All modules have the following basic file/folder structure:

```
- DESCRIPTION
- R/
    - functions.R
- dockerfiles/
    - latest/
        - Dockerfile
- om.yaml
- README.md
- .travis.yml
```

### R files and folders

The R package is encapsulated by the `DESCRIPTION` file and the `R/` folder.
The first of these describes the package details (package name, author,
dependencies, etc.) and the second contains the R code that make up the package.
The `R/` folder can have any number of scripts with whatever names a developer
wants (default `functions.R`).

### Docker files and folders

The `outsider` package and its modules depend on Docker to run. Docker acts
like a virtual machine on a user's computer. It allows users to run specific
code, often designed for different operating systems, on any machine that has
Docker installed. These code snippets are called Docker images. And these
images are described by a `Dockerfile`. The `dockerfiles/` folder in the
module contains the `Dockerfile` that describes how to install the external
command-line program that the develop wishes to run through R. `dockerfiles/`
can have multiple versions of a `Dockerfile` but every module must have a
`latest/`.

### GitHub files and folders

To make modules discoverable on GitHub, all modules require an `om.yml`.
This file has two elements (program and details) encoded in the
[YAML format](https://en.wikipedia.org/wiki/YAML). To describe the module on
the GitHub website a `README.md` is required.

# Walkthrough

We will walk you through how to create your very own `outsider` module that will
simply run print whatever is given to it.

## Generate the package

To begin, we can use the `module_skeleton()` function. This will request a few
details about the module and will then generate the above core files and
folders.

```{r skeleton}
library(outsider)
.module_skeleton(github_user = 'dombennett', program_name = 'echo',
                 docker_user = 'dombennett')
```

The above code will create an `outsider` module with the name `om..echor`.
Because by default the `Dockerfile` generates an image for Ubuntu and because
we are creating a module based around the simple Unix command `echo` (as
indicated with the "Program name: echo") we can build the module and test it
straight away.

### Build a module

The building of a module comes in two steps: build the Docker image and
install the R package.

```{r build_install, eval = FALSE}
library(outsider)

```


## Dockerfiles

In every `outsider` module there is a folder for all dockerfiles. 

We need to build the docker image. `docker build -t [docker-hub-name]/[name]:[tag] dockerfiles/[tag]/.`

```{bash docker-build}
docker build -t dombennett/om_echo:latest om..echo/dockerfiles/latest/.
```

```{r build-package}
devtools::document('om..echo')
devtools::install('om..echo')
```

```{r test-package}
library(outsider)
echo <- module_import('echo', repo = 'dombennett/om..echo')
echo('hello world!')
```

```{r clean-up, include=FALSE}
module_uninstall(repo = 'dombennett/om..echo')
unlink(x = 'om..echo', recursive = TRUE, force = TRUE)
```
